<!DOCTYPE html>
<html>
<head itemscope itemtype="http://schema.org/WebSite">
	<title itemprop='name'>LapFox Radio</title>
	<link rel="canonical" href="https://lapfoxradio.com/" itemprop="url">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Radio for Halley Labs / LapFox Trax music">
	<meta name="theme-color" content="#000000">

	<meta name="twitter:card" content="summary" />
	<meta name="twitter:image" content="https://lapfoxradio.com/lapfox-radio-icon-black.png" />

	<meta property="og:title" content="LapFox Radio" />
	<meta property="og:type" content="music.radio_station" />
	<meta property="og:description" content="Radio for Halley Labs / LapFox Trax music" />
	<meta property="og:url" content="https://lapfoxradio.com/" />

	<meta property="og:audio" content="https://radio-temp.lapfoxradio.com/radio/8000/stream-ogg-128.ogg" />
	<meta property="og:audio:type" content="audio/ogg" />

	<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="icon" type="image/png" sizes="400x400" href="/lapfox-radio-icon-black.png">
	<link rel="manifest" href="/manifest.json">
	<meta name="apple-mobile-web-app-title" content="LapFox Radio">
	<meta name="application-name" content="LapFox Radio">

	<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cyborg/bootstrap.min.css" rel="stylesheet" integrity="sha384-D9XILkoivXN+bcvB2kSOowkIvIcBbNdoDQvfBNsxYAIieZbx8/SI4NeUvrRGCpDi" crossorigin="anonymous">
	<style>
	body {
	    background-color: black;
	}
	</style>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-7728219-20', 'auto');
	  ga('send', 'pageview');

	</script>

</head>
<body>
    <div class="container">
      <h2>LapFox Radio is currently transitioning to a new server, some things may not work right.</h2>
    	<!--<div class="row">
    	<div class="col-md-12">
        <img src="lapfoxradio.png" class="center-block img-responsive" alt="LapFox Radio">
        </div>
        </div>-->
        <br><br>
        <div class="row">
        <div class="col-md-6">
            <img id="nowplaying-art" src="/lapfox-radio-icon-black.png" width="80%">
        </div>
        <div class="col-md-6">
        </div>
        </div>
        <br>
        <div class="row">
        <div class="col-md-6">
        <div id="station">
        			<h6>Now Playing:</h6>
                    <h4 class="media-heading nowplaying-title">Song Title</h4>
                    <span class="nowplaying-artist">Song Artist</span>
                    <div class="nowplaying-progress" style="display: none;">

                    </div>
        </div>
        <br>
               <!-- <audio controls preload="none">
  <source src="https://radio.lapfoxradio.com/radio/8000/stream-ogg-320.ogg" type="audio/ogg">
  <source src="https://radio.lapfoxradio.com/radio/8000/stream-mp3-320.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio> -->

<!-- BEGINS: AUTO-GENERATED MUSES RADIO PLAYER CODE -->
<script type="text/javascript" src="https://hosted.muses.org/mrp.js"></script>
<script type="text/javascript">
MRP.insert({
'url':'https://radio-temp.lapfoxradio.com/radio/8000/stream-ogg-128.ogg?1496168926',
'codec':'ogg',
'volume':100,
'autoplay':false,
'jsevents':true,
'buffering':0,
'forceHTML5':true,
'title':'LapFox Radio',
'wmode':'transparent',
'skin':'substream',
'width':180,
'height':30
});
</script>

<!-- ENDS: AUTO-GENERATED MUSES RADIO PLAYER CODE -->
<br>
<div id="station2">	
<p>Currently <span class="nowplaying-listeners">0</span> listeners</p>
<h6>Playing Next:</h6>
<img id="nowplaying-next-art" src="/lapfox-radio-icon-black.png" height="40px" style="float: left; margin-right: 8px">
<b class="nowplaying-next-title">Song Title</b><br>
<span class="nowplaying-next-artist">Song Artist</span>
<h6>Recently Played:</h6>
<ol id="song-history">
</ol>
</div>
</div>
<div class="col-md-6">
<div>
<h6>Raw Streams:</h6>
<ul>
<li><a href="https://radio-temp.lapfoxradio.com/radio/8000/stream-ogg-320.ogg">320kbps OGG Vorbis</a></li>
<li><a href="https://radio-temp.lapfoxradio.com/radio/8000/stream-ogg-128.ogg">128kbps OGG Vorbis</a></li>
<li><a href="https://radio-temp.lapfoxradio.com/radio/8000/stream-mp3-320.mp3">320kbps MP3</a></li>
</ul>
</div>
<div>
<h6>Playlists:</h6>
<ul>
<li><a href="lapfox_radio.pls">PLS file</a></li>
<li><a href="lapfox_radio.m3u">M3U file</a></li>
</ul>
</div>
<br>
<div>Maintained by <a href="https://floogulinc.com/">floogulinc</a>
<br>Music &copy; <a href="http://www.lapfoxtrax.com/" target="_blank">LapFox Trax</a>
<br>Powered by <a href="http://azuracast.com/">Azuracast</a>
</div>

</div>
</div>

    </div><!-- /.container -->


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha384-xBuQ/xzmlsLoJpyjoggmTEz8OWUFM0/RC5BsqQBDX2v5cMvDHcMakNTNrHIW2I5f" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script type="text/javascript">

var nowplayingurl = "https://radio-temp.lapfoxradio.com/api/nowplaying/lapfox_radio";

var oldsongid = "";

var isPlaying = false;

var canCall = true;

function nowPlayingLimited() {
	console.log("nowPlayingLimited() called")
	if (!canCall) 
            return;

    nowPlaying();

    canCall = false;
        setTimeout(function(){
            canCall = true;
        }, 5000);

}

function nowPlaying() {
     console.log("nowPlaying called");
     $.ajax({
        cache: false,
        dataType: "json",
        url: nowplayingurl,
        success: nowPlayingFunc,
        fail: function() {
            console.log("nowPlaying ajax fail");
        }
    });
}

function nowPlayingFunc(row) {
        station_row = $('#station')
        station_row2 = $('#station2')

        station_row.find('.nowplaying-title').text(row.now_playing.song.title);
        station_row.find('.nowplaying-artist').text(row.now_playing.song.artist + " - " + row.now_playing.song.album);
        $('#nowplaying-art').attr("src", row.now_playing.song.art);
        station_row2.find('.nowplaying-listeners').text(row.listeners.total);

        station_row2.find('.nowplaying-next-title').html(row.playing_next.song.title);
        station_row2.find('.nowplaying-next-artist').text(row.playing_next.song.artist);
        $('#nowplaying-next-art').attr("src", row.playing_next.song.art);

        if(isPlaying && oldsongid != row.now_playing.song.id) {
            oldsongid = row.now_playing.song.id;
            if (("Notification" in window)) {
                if(Notification.permission === "granted") {
                var n = new Notification(row.now_playing.song.title,{
                      body: row.now_playing.song.artist,
                      icon: row.now_playing.song.art,
                      silent: true
                  });
                setTimeout(n.close.bind(n), 5000);
                n.onclick = function () {
                  window.focus();
                }
            } else if (Notification.permission !== 'denied') {
            Notification.requestPermission(function (permission) {
              // If the user accepts, let's create a notification
              if (permission === "granted") {
                var n = new Notification(row.now_playing.song.title,{
                  body: row.now_playing.song.artist,
                  icon: row.now_playing.song.art,
                  silent: true
              });
                setTimeout(n.close.bind(n), 5000);
                n.onclick = function () {
                  window.focus();
                }
              }
              ga('send', 'event', 'notification_request_permission', permission);
                });
              }
            }
        }



        document.title = row.now_playing.song.title + " - " + row.now_playing.song.artist + " - LapFox Radio"

        if ('mediaSession' in navigator) {
            navigator.mediaSession.metadata = new MediaMetadata({
            title: row.now_playing.song.title,
            artist: row.now_playing.song.artist,
            album: row.now_playing.song.album,
            artwork: [{src: row.now_playing.song.art}]
          });
        }

        $('#song-history').empty();
        $.each(row.song_history, function(i, history_row) {
            var li = $('<li>').append('<b>'+history_row.song.title+'</b><br>'+history_row.song.artist);
            $('#song-history').append(li);
        });

        if (row.now_playing.duration) {
            var time_played = row.now_playing.elapsed;
            var time_total = row.now_playing.duration;

            if (time_played > time_total) {
                time_played = time_total;
            }

            var time_display = formatTime(time_played) + ' / ' + formatTime(time_total);

            station_row.find('.nowplaying-progress')
                .data('time-played', time_played)
                .data('time-total', time_total)
                .text(time_display)
                .show();
        } else {
            station_row.find('.nowplaying-progress').hide();
        }
}

function musesCallback(event,value){
	console.log("muses event: " + event + ": " + value);
    if(event == "play" && isPlaying == false) {
    	isPlaying = true;
    	ga('send', 'event', 'radio_player', 'play');
    	nowPlaying();
    } else if(event == "stop") {
    	isPlaying = false;
    	ga('send', 'event', 'radio_player', 'stop');
    }
}

function iterateTimer() {
    $('.nowplaying-progress:visible').each(function () {
        var time_played = $(this).data('time-played') + 1;
        var time_total = $(this).data('time-total');

        if (time_played > time_total) {
            time_played = time_total;
            nowPlayingLimited();
        }

        var time_display = formatTime(time_played) + ' / ' + formatTime(time_total);

        $(this).data('time-played', time_played)
            .text(time_display)
    });
}

function formatTime(time) {
    var sec_num = parseInt(time, 10);

    var hours = Math.floor(sec_num / 3600);
    var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
    var seconds = sec_num - (hours * 3600) - (minutes * 60);

    if (hours < 10) {
        hours = "0" + hours;
    }
    if (minutes < 10) {
        minutes = "0" + minutes;
    }
    if (seconds < 10) {
        seconds = "0" + seconds;
    }
    return (hours !== "00" ? hours + ':' : "") + minutes + ':' + seconds;
}

$(function() {

	nowPlaying();
    window.setInterval(nowPlaying, 30*1000);
    window.setInterval(iterateTimer, 1000);

	if ('serviceWorker' in navigator) {
	  window.addEventListener('load', function() {
	    navigator.serviceWorker.register('/sw.js').then(function(registration) {
	      // Registration was successful
	      console.log('ServiceWorker registration successful with scope: ', registration.scope);
	    }, function(err) {
	      // registration failed :(
	      console.log('ServiceWorker registration failed: ', err);
	    });
	  });
	}

	if (("Notification" in window)) {
			    if(Notification.permission === "granted") {
			    	ga('send', 'event', 'notification_permission', 'already_granted');
			    }
			}

	window.addEventListener('beforeinstallprompt', function(e) {
	  // beforeinstallprompt Event fired

	  // e.userChoice will return a Promise. 
	  // For more details read: https://developers.google.com/web/fundamentals/getting-started/primers/promises
	  e.userChoice.then(function(choiceResult) {
	    console.log(choiceResult.outcome);
	    ga('send', 'event', 'home_screen_install', choiceResult.outcome);
	  });
});

});

</script>


</body>
</html>